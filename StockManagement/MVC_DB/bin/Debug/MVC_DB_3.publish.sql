/*
Deployment script for StockManagement

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "StockManagement"
:setvar DefaultFilePrefix "StockManagement"
:setvar DefaultDataPath "C:\Users\pedro\AppData\Local\Microsoft\Microsoft SQL Server Local DB\Instances\MSSQLLocalDB"
:setvar DefaultLogPath "C:\Users\pedro\AppData\Local\Microsoft\Microsoft SQL Server Local DB\Instances\MSSQLLocalDB"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [$(DatabaseName)];


GO
PRINT N'Dropping unnamed constraint on [dbo].[Material]...';


GO
ALTER TABLE [dbo].[Material] DROP CONSTRAINT [DF__Material__Specs___2B3F6F97];


GO
PRINT N'Dropping unnamed constraint on [dbo].[Provider]...';


GO
ALTER TABLE [dbo].[Provider] DROP CONSTRAINT [DF__Provider__Phone___2C3393D0];


GO
PRINT N'Dropping unnamed constraint on [dbo].[Provider]...';


GO
ALTER TABLE [dbo].[Provider] DROP CONSTRAINT [DF__Provider__Mail_P__2D27B809];


GO
PRINT N'Dropping unnamed constraint on [dbo].[Provider]...';


GO
ALTER TABLE [dbo].[Provider] DROP CONSTRAINT [DF__Provider__Addres__2E1BDC42];


GO
PRINT N'Dropping unnamed constraint on [dbo].[Provider]...';


GO
ALTER TABLE [dbo].[Provider] DROP CONSTRAINT [DF__Provider__Nif_Pr__2F10007B];


GO
PRINT N'Dropping unnamed constraint on [dbo].[StockMaterial]...';


GO
ALTER TABLE [dbo].[StockMaterial] DROP CONSTRAINT [DF__StockMate__Amoun__300424B4];


GO
PRINT N'Dropping unnamed constraint on [dbo].[StockMaterial]...';


GO
ALTER TABLE [dbo].[StockMaterial] DROP CONSTRAINT [DF__StockMate__Obser__30F848ED];


GO
PRINT N'Dropping unnamed constraint on [dbo].[Supply]...';


GO
ALTER TABLE [dbo].[Supply] DROP CONSTRAINT [DF__Supply__TotalPri__31EC6D26];


GO
PRINT N'Dropping unnamed constraint on [dbo].[Supply]...';


GO
ALTER TABLE [dbo].[Supply] DROP CONSTRAINT [DF__Supply__Date_Sup__32E0915F];


GO
PRINT N'Starting rebuilding table [dbo].[Material]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Material] (
    [Id_Material]    INT           IDENTITY (1, 1) NOT NULL,
    [Name_Material]  NVARCHAR (50) NOT NULL,
    [Specs_Material] NVARCHAR (50) DEFAULT ('Nada a registar') NULL,
    PRIMARY KEY CLUSTERED ([Id_Material] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Material])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Material] ON;
        INSERT INTO [dbo].[tmp_ms_xx_Material] ([Id_Material], [Name_Material], [Specs_Material])
        SELECT   [Id_Material],
                 [Name_Material],
                 [Specs_Material]
        FROM     [dbo].[Material]
        ORDER BY [Id_Material] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Material] OFF;
    END

DROP TABLE [dbo].[Material];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Material]', N'Material';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[Provider]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Provider] (
    [Id_Provider]      INT           IDENTITY (1, 1) NOT NULL,
    [Name_Provider]    NVARCHAR (50) NOT NULL,
    [Phone_Provider]   NVARCHAR (50) DEFAULT ('Nada a registar') NULL,
    [Mail_Provider]    NVARCHAR (50) DEFAULT ('Nada a registar') NULL,
    [Address_Provider] NVARCHAR (50) DEFAULT ('Nada a registar') NULL,
    [Nif_Provider]     NVARCHAR (50) DEFAULT ('Nada a registar') NULL,
    PRIMARY KEY CLUSTERED ([Id_Provider] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Provider])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Provider] ON;
        INSERT INTO [dbo].[tmp_ms_xx_Provider] ([Id_Provider], [Name_Provider], [Phone_Provider], [Mail_Provider], [Address_Provider], [Nif_Provider])
        SELECT   [Id_Provider],
                 [Name_Provider],
                 [Phone_Provider],
                 [Mail_Provider],
                 [Address_Provider],
                 [Nif_Provider]
        FROM     [dbo].[Provider]
        ORDER BY [Id_Provider] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Provider] OFF;
    END

DROP TABLE [dbo].[Provider];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Provider]', N'Provider';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[Section]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Section] (
    [Id_Section]   INT           IDENTITY (1, 1) NOT NULL,
    [Name_Section] NVARCHAR (50) NOT NULL,
    PRIMARY KEY CLUSTERED ([Id_Section] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Section])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Section] ON;
        INSERT INTO [dbo].[tmp_ms_xx_Section] ([Id_Section], [Name_Section])
        SELECT   [Id_Section],
                 [Name_Section]
        FROM     [dbo].[Section]
        ORDER BY [Id_Section] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Section] OFF;
    END

DROP TABLE [dbo].[Section];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Section]', N'Section';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[StockMaterial]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_StockMaterial] (
    [Id_StockMaterial] INT           IDENTITY (1, 1) NOT NULL,
    [Id_Material]      INT           NOT NULL,
    [Id_Provider]      INT           NOT NULL,
    [Id_Section]       INT           NOT NULL,
    [Amount_Material]  INT           DEFAULT 0 NULL,
    [Observations]     NVARCHAR (50) DEFAULT ('Nada a registar') NULL,
    PRIMARY KEY CLUSTERED ([Id_StockMaterial] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[StockMaterial])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_StockMaterial] ON;
        INSERT INTO [dbo].[tmp_ms_xx_StockMaterial] ([Id_StockMaterial], [Id_Material], [Id_Provider], [Id_Section], [Amount_Material], [Observations])
        SELECT   [Id_StockMaterial],
                 [Id_Material],
                 [Id_Provider],
                 [Id_Section],
                 [Amount_Material],
                 [Observations]
        FROM     [dbo].[StockMaterial]
        ORDER BY [Id_StockMaterial] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_StockMaterial] OFF;
    END

DROP TABLE [dbo].[StockMaterial];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_StockMaterial]', N'StockMaterial';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[Supply]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Supply] (
    [Id_Supply]        INT            IDENTITY (1, 1) NOT NULL,
    [Id_Provider]      INT            NOT NULL,
    [Id_Material]      INT            NOT NULL,
    [Amount_Material]  INT            NOT NULL,
    [TotalPrice_Suply] DECIMAL (4, 2) DEFAULT 0.0 NULL,
    [Date_Supply]      DATE           DEFAULT (getdate()) NULL,
    PRIMARY KEY CLUSTERED ([Id_Supply] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Supply])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Supply] ON;
        INSERT INTO [dbo].[tmp_ms_xx_Supply] ([Id_Supply], [Id_Provider], [Id_Material], [Amount_Material], [TotalPrice_Suply], [Date_Supply])
        SELECT   [Id_Supply],
                 [Id_Provider],
                 [Id_Material],
                 [Amount_Material],
                 [TotalPrice_Suply],
                 [Date_Supply]
        FROM     [dbo].[Supply]
        ORDER BY [Id_Supply] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Supply] OFF;
    END

DROP TABLE [dbo].[Supply];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Supply]', N'Supply';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Update complete.';


GO
